<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizaciones Combinadas D3.js - Alan Valbuena</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #2c3e50;
            color: #ecf0f1;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #ecf0f1;
            margin-bottom: 10px;
            text-align: center;
            font-size: 2.5em;
        }
        
        .subtitle {
            color: #bdc3c7;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        
        .author {
            color: #3498db;
            text-align: center;
            margin-bottom: 40px;
            font-size: 1.2em;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .visualization-section {
            margin-bottom: 50px;
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        .section-title {
            color: #ecf0f1;
            font-size: 1.8em;
            margin-bottom: 15px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .section-description {
            color: #bdc3c7;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1em;
        }
        
        .fire-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .brush-container {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .chart-wrapper {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            margin: 10px;
        }
        
        .chart-title {
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        .fire-svg {
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .brush-svg {
            border-radius: 10px;
        }
        
        #restartBtn {
            padding: 8px 16px;
            margin-top: 5px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        
        #restartBtn:hover {
            background: #2980b9;
        }
        
        @media (max-width: 768px) {
            .brush-container {
                flex-direction: column;
                align-items: center;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .visualization-section {
                padding: 20px;
            }
        }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>üé® Visualizaciones Interactivas D3.js</h1>
        <p class="subtitle">Cinco experiencias visuales √∫nicas combinadas en una sola p√°gina</p>
        <div class="author">üë®‚Äçüíª Creado por Alan Valbuena</div>
        
        <!-- Visualizaci√≥n 1: Efecto de Fuego -->
        <div class="visualization-section">
            <h2 class="section-title">üî• Efecto de Fuego con Cursor</h2>
            <p class="section-description">Mueve el cursor r√°pidamente para crear part√≠culas de fuego animadas</p>
            
            <div class="fire-container">
                <div class="chart-wrapper">
                    <div class="chart-title">√Årea de Fuego Interactiva</div>
                    <svg id="coords" width="500" height="350" class="fire-svg" style="background: #f9f9f9; cursor: crosshair;">
                        <defs>
                            <radialGradient id="fireGradient" cx="50%" cy="50%" r="50%">
                                <stop offset="0%" style="stop-color:#ffff00;stop-opacity:1" />
                                <stop offset="30%" style="stop-color:#ff6600;stop-opacity:0.8" />
                                <stop offset="60%" style="stop-color:#ff0000;stop-opacity:0.6" />
                                <stop offset="100%" style="stop-color:#990000;stop-opacity:0.2" />
                            </radialGradient>
                        </defs>
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- Visualizaci√≥n 2: Brush Interactivo -->
        <div class="visualization-section">
            <h2 class="section-title">üìä Brush Interactivo Vinculado</h2>
            <p class="section-description">Mueve el cursor sobre el primer gr√°fico para ver el efecto en ambas visualizaciones</p>
            
            <div class="brush-container">
                <div class="chart-wrapper">
                    <div class="chart-title">Gr√°fico Principal (Interactivo)</div>
                    <svg id="brush1" width="300" height="300" class="brush-svg" style="background:lightgrey;"></svg>
                </div>
                <div class="chart-wrapper">
                    <div class="chart-title">Gr√°fico Secundario (Vinculado)</div>
                    <svg id="brush2" width="300" height="300" class="brush-svg" style="background:lightgrey;"></svg>
                </div>
            </div>
        </div>
        
        <!-- Visualizaci√≥n 3: Drag & Drop -->
        <div class="visualization-section">
            <h2 class="section-title">üéØ Drag & Drop Interactivo</h2>
            <p class="section-description">Arrastra los c√≠rculos para moverlos por el √°rea</p>
            
            <div class="fire-container">
                <div class="chart-wrapper">
                    <div class="chart-title">√Årea de Arrastre</div>
                    <svg id="dragdrop" width="600" height="200" class="brush-svg" style="background:lightgrey; cursor: grab;">
                        <circle cx="100" cy="100" r="20" fill="red" />
                        <circle cx="300" cy="100" r="20" fill="green" />
                        <circle cx="500" cy="100" r="20" fill="blue" />
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- Visualizaci√≥n 4: Animaci√≥n Stagger -->
        <div class="visualization-section">
            <h2 class="section-title">üìà Animaci√≥n Stagger</h2>
            <p class="section-description">Haz clic en el gr√°fico para ver el efecto de animaci√≥n escalonada</p>
            
            <div class="fire-container">
                <div class="chart-wrapper">
                    <div class="chart-title">Gr√°fico de Barras Animado</div>
                    <svg id="stagger" width="600" height="300" class="brush-svg" style="background:lightgrey; cursor: pointer;"></svg>
                    <p style="text-align: center; margin-top: 10px; font-size: 0.9em; color: #666;">
                        ¬°Haz clic en el gr√°fico para ver la animaci√≥n escalonada!
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Visualizaci√≥n 5: Curvas de Lissajous -->
        <div class="visualization-section">
            <h2 class="section-title">üåÄ Curvas de Lissajous</h2>
            <p class="section-description">Animaci√≥n matem√°tica de curvas param√©tricas</p>
            
            <div class="fire-container">
                <div class="chart-wrapper">
                    <div class="chart-title">Animaci√≥n de Lissajous</div>
                    <svg id="lissajous" width="300" height="300" class="brush-svg" style="background:lightgrey;"></svg>
                    <div style="text-align: center; margin-top: 10px;">
                        <p style="font-size: 0.9em; color: #666; margin: 5px 0;">
                            Frecuencias: a = 1.9, b = 3.2 | Animaci√≥n de 2 minutos
                        </p>
                        <button id="restartBtn">
                            Reiniciar Animaci√≥n
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============== VISUALIZACI√ìN 1: EFECTO DE FUEGO (CORREGIDA) ==============
        function initFireEffect() {
            const svg = d3.select('#coords');
            const txt = svg.append('text')
                           .attr('font-family', 'Arial, sans-serif')
                           .attr('font-size', '14px')
                           .attr('fill', '#2c3e50')
                           .attr('font-weight', 'bold')
                           .style('pointer-events', 'none');

            let lastPosition = [0, 0];
            let lastTime = Date.now();
            let fireParticles = [];

            function createFireParticle(x, y, intensity) {
                const particle = svg.append('circle')
                    .attr('cx', x + (Math.random() - 0.5) * 20)
                    .attr('cy', y + (Math.random() - 0.5) * 20)
                    .attr('r', Math.random() * 8 + 2)
                    .attr('fill', 'url(#fireGradient)')
                    .style('opacity', intensity);

                // Animate the particle
                particle.transition()
                    .duration(800 + Math.random() * 400)
                    .ease(d3.easeQuadOut)
                    .attr('cy', y - 30 - Math.random() * 40)
                    .attr('r', 0)
                    .style('opacity', 0)
                    .on('end', function() {
                        particle.remove();
                    });

                fireParticles.push(particle);
            }

            svg.on('mousemove', function(event) {
                const pt = d3.pointer(event, this);
                const currentTime = Date.now();
                
                // Calculate speed
                const deltaX = pt[0] - lastPosition[0];
                const deltaY = pt[1] - lastPosition[1];
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                const deltaTime = currentTime - lastTime;
                const speed = distance / (deltaTime || 1);

                // Update coordinate text
                txt.attr('x', 18 + pt[0])
                   .attr('y', 6 + pt[1])
                   .text('üî• (' + Math.round(pt[0]) + ',' + Math.round(pt[1]) + ') Velocidad: ' + speed.toFixed(1));

                // Create fire effect if moving fast
                const speedThreshold = 1.5;
                if (speed > speedThreshold && deltaTime > 0) {
                    const intensity = Math.min(speed / 5, 1);
                    const numParticles = Math.floor(intensity * 5) + 1;
                    
                    for (let i = 0; i < numParticles; i++) {
                        createFireParticle(pt[0], pt[1], intensity);
                    }
                }

                lastPosition = pt;
                lastTime = currentTime;
            });

            // Clean up on mouse leave
            svg.on('mouseleave', function() {
                txt.text('');
            });
        }

        // ============== VISUALIZACI√ìN 2: BRUSH INTERACTIVO (CORREGIDA) ==============
        function initBrushVisualization() {
            // Datos de ejemplo (simulando el CSV)
            const data = [
                {A: 50, B: 80}, {A: 120, B: 150}, {A: 200, B: 100}, {A: 80, B: 200},
                {A: 150, B: 50}, {A: 250, B: 180}, {A: 30, B: 120}, {A: 180, B: 250},
                {A: 100, B: 30}, {A: 220, B: 200}, {A: 60, B: 160}, {A: 160, B: 80},
                {A: 240, B: 120}, {A: 40, B: 240}, {A: 140, B: 40}, {A: 280, B: 160},
                {A: 20, B: 180}, {A: 190, B: 60}, {A: 110, B: 220}, {A: 270, B: 90},
                {A: 90, B: 140}, {A: 210, B: 280}, {A: 130, B: 20}, {A: 260, B: 240},
                {A: 70, B: 70}, {A: 170, B: 170}, {A: 230, B: 130}, {A: 290, B: 270}
            ];

            function makeBrush() {
                var svg1 = d3.select("#brush1"), svg2 = d3.select("#brush2");

                var sc1 = d3.scaleLinear()
                    .domain([0, 10, 50])
                    .range(["lime", "yellow", "red"]);
                var sc2 = d3.scaleLinear()
                    .domain([0, 10, 50])
                    .range(["lime", "yellow", "blue"]);

                var cs1 = drawCircles(svg1, data, d => +d.A, d => +d.B, sc1);
                var cs2 = drawCircles(svg2, data, d => +d.A, d => +d.B, sc2);

                svg1.call(installHandlers, data, cs1, cs2, sc1, sc2);
            }

            function drawCircles(svg, data, accX, accY, sc) {
                var color = sc(Infinity);
                return svg.selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("r", 6)
                    .attr("cx", accX)
                    .attr("cy", accY)
                    .attr("fill", color)
                    .attr("fill-opacity", 0.6)
                    .attr("stroke", "white")
                    .attr("stroke-width", 1)
                    .style("transition", "fill 0.2s ease");
            }

            function installHandlers(svg, data, cs1, cs2, sc1, sc2) {
                svg.style("cursor", "crosshair")
                    .on("mousemove", function(event) {
                        var pt = d3.pointer(event, this);
                        cs1.attr("fill", function(d, i) {
                            var r = Math.hypot(pt[0] - d3.select(this).attr("cx"),
                                             pt[1] - d3.select(this).attr("cy"));
                            data[i]["r"] = r;
                            return sc1(r);
                        });
                        cs2.attr("fill", (d, i) => sc2(data[i]["r"]));
                    })
                    .on("mouseleave", function() {
                        cs1.attr("fill", sc1(Infinity));
                        cs2.attr("fill", sc2(Infinity));
                    });
            }

            makeBrush();
        }

        // ============== VISUALIZACI√ìN 3: DRAG & DROP (CORREGIDA) ==============
        function initDragDrop() {
            let widget = undefined, color = undefined;

            const drag = d3.drag()
                .on("start", function(event, d) {
                    color = d3.select(this).attr("fill");
                    widget = d3.select(this).attr("fill", "lime");
                    d3.select("#dragdrop").style("cursor", "grabbing");
                })
                .on("drag", function(event, d) {
                    widget.attr("cx", event.x).attr("cy", event.y);
                })
                .on("end", function(event, d) {
                    widget.attr("fill", color);
                    widget = undefined;
                    d3.select("#dragdrop").style("cursor", "grab");
                });

            d3.select("#dragdrop").selectAll("circle")
                .style("cursor", "grab")
                .call(drag);
        }

        // ============== VISUALIZACI√ìN 4: STAGGER ANIMATION ==============
        function initStaggerAnimation() {
            let ds1 = [2, 1, 3, 5, 7, 8, 9, 9, 9, 8, 7, 5, 3, 1, 2];
            let ds2 = [8, 9, 8, 7, 5, 3, 2, 1, 2, 3, 5, 7, 8, 9, 8];
            const n = ds1.length;
            const mx = d3.max(d3.merge([ds1, ds2]));
            const svg = d3.select("#stagger");

            const scX = d3.scaleLinear().domain([0, n]).range([50, 540]);
            const scY = d3.scaleLinear().domain([0, mx]).range([250, 50]);

            // Create initial bars
            svg.selectAll("line")
                .data(ds1)
                .enter()
                .append("line")
                .attr("stroke", "red")
                .attr("stroke-width", 20)
                .attr("x1", (d, i) => scX(i))
                .attr("y1", scY(0))
                .attr("x2", (d, i) => scX(i))
                .attr("y2", d => scY(d));

            // Add click handler for animation
            svg.on("click", function(event) {
                [ds1, ds2] = [ds2, ds1];
                svg.selectAll("line")
                    .data(ds1)
                    .transition()
                    .duration(1000)
                    .delay((d, i) => 200 * i)
                    .attr("y2", d => scY(d));
            });
        }

        // ============== VISUALIZACI√ìN 5: LISSAJOUS CURVES ==============
        let currentTimer = null;

        function initLissajous() {
            function makeLissajous() {
                // Stop any existing timer
                if (currentTimer) {
                    currentTimer.stop();
                }
                
                // Clear the SVG
                const svg = d3.select("#lissajous");
                svg.selectAll("*").remove();
                
                const a = 1.9, b = 3.2;             // Lissajous frequencies
                let phi, omega = 2 * Math.PI / 10000; // 10 seconds per period

                let crrX = 150 + 100, crrY = 150 + 0;
                let prvX = crrX, prvY = crrY;

                currentTimer = d3.timer(function(t) {
                    phi = omega * t;

                    crrX = 150 + 100 * Math.cos(a * phi);
                    crrY = 150 + 100 * Math.sin(b * phi);

                    // Fade existing lines
                    svg.selectAll("line")
                        .each(function() { 
                            if (!this.bogus_opacity) this.bogus_opacity = 1.0;
                            this.bogus_opacity *= 0.99;
                        })
                        .attr("stroke-opacity", function() { return this.bogus_opacity; })
                        .filter(function() { return this.bogus_opacity < 0.05; })
                        .remove();

                    // Add new line segment
                    svg.append("line")
                        .each(function() { this.bogus_opacity = 1.0; })
                        .attr("x1", prvX).attr("y1", prvY)
                        .attr("x2", crrX).attr("y2", crrY)
                        .attr("stroke", "green").attr("stroke-width", 2);

                    prvX = crrX;
                    prvY = crrY;

                    if (t > 120e3) { // 120 seconds
                        currentTimer.stop();
                        currentTimer = null;
                    }
                });
            }

            // Start the animation
            makeLissajous();
            
            // Add restart button functionality
            document.getElementById('restartBtn').addEventListener('click', makeLissajous);
        }

        // ============== INICIALIZACI√ìN ==============
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar todas las visualizaciones
            initFireEffect();
            initBrushVisualization();
            initDragDrop();
            initStaggerAnimation();
            initLissajous();
            
            console.log("üé® Todas las visualizaciones D3.js inicializadas correctamente - Alan Valbuena");
        });
    </script>
</body>
</html>
